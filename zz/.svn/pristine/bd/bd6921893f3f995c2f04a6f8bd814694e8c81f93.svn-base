<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:shiro="http://www.pollix.at/thymeleaf/shiro">
<head>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
    <meta charset="utf-8"/>

    <title>欢迎页</title>

    <meta name="viewport"
          content="width=device-width, initial-scale=1.0, maximum-scale=1.0"/>

    <!--[if !IE]> -->
    <link rel="stylesheet" th:href="@{/assets/css/pace.css}"/>
    <script
            data-pace-options='{ "ajax": true, "document": true, "eventLag": false, "elements": false }'
            th:src="@{/assets/js/pace.js}"></script>

    <!-- <![endif]-->

    <!-- bootstrap & fontawesome -->
    <link rel="stylesheet" th:href="@{/assets/css/bootstrap.css}"/>
    <link rel="stylesheet" th:href="@{/assets/css/font-awesome.css}"/>

    <link rel="stylesheet" th:href="@{/assets/css/jquery-ui.css}"/>

    <!-- text fonts -->
    <link rel="stylesheet" th:href="@{/assets/css/ace-fonts.css}"/>

    <!-- ace styles -->
    <link rel="stylesheet" th:href="@{/assets/css/ace.css}"
          class="ace-main-stylesheet" id="main-ace-style"/>

    <!--[if lte IE 9]>
    <link rel="stylesheet" href="${ctx }assets/css/ace-part2.css" class="ace-main-stylesheet"/>
    <![endif]-->

    <!--[if lte IE 9]>
    <link rel="stylesheet" href="${ctx }assets/css/ace-ie.css"/>
    <![endif]-->

    <!-- ace settings handler -->
    <script th:src="@{/assets/js/ace-extra.js}"></script>
    <script th:src="@{/assets/js/kindeditor/kindeditor-all.js}"></script>
    <script th:src="@{/assets/js/kindeditor/lang/zh_CN.js}"></script>

    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->

    <!--[if lte IE 8]>
    <script src="${ctx }assets/js/html5shiv.js"></script>
    <script src="${ctx }assets/js/respond.js"></script>
    <![endif]-->
</head>
<body class="no-skin">

<div id="dialog-change-password" class="hide">
    <form class="form-horizontal" id="validation-form">
        <input type="hidden" autofocus="autofocus"/> <span
            class="ace-icon fa blue bigger-120">原始密码</span>
        <div class="space-4"></div>
        <div class="clearfix">
            <input type="password" name="old_password" id="old_password"
                   class="width-100"/>
        </div>
        <div class="space-4"></div>
        <span class="ace-icon fa blue bigger-120">新密码</span>
        <div class="space-4"></div>
        <div class="clearfix">
            <input type="password" name="new_password" id="new_password"
                   class="width-100"/>
        </div>
        <div class="space-4"></div>
        <span class="ace-icon fa blue bigger-120">确认新密码</span>
        <div class="space-4"></div>
        <div class="clearfix">
            <input type="password" name="confirm_old_password"
                   id="confirm_old_password" class="width-100"/>
        </div>
    </form>
</div>
<!-- #dialog-message -->

<!-- #section:basics/navbar.layout -->
<div class="navbar navbar-default">
    <script type="text/javascript">
        /*<![CDATA[*/
        try {
            ace.settings.check('navbar', 'fixed')
        } catch (e) {
        }
        /*]]>*/
    </script>

    <div class="navbar-container" id="navbar-container">
        <!-- /section:basics/sidebar.mobile.toggle -->
        <div class="navbar-header pull-left">
            <!-- #section:basics/navbar.layout.brand -->
            <a href="#" class="navbar-brand">
                <small><i
                        class="fa fa-desktop"></i> 后台管理
                </small>
            </a>

            <!-- /section:basics/navbar.layout.brand -->

            <!-- #section:basics/navbar.toggle -->

            <!-- /section:basics/navbar.toggle -->
        </div>

        <!-- #section:basics/navbar.dropdown -->
        <div class="navbar-buttons navbar-header pull-right"
             role="navigation">
            <ul class="nav ace-nav">
                <li class="light-blue"><a data-toggle="dropdown" href="#"
                                          class="dropdown-toggle"> <span class="user-info"> <small>Welcome,</small>
								<span shiro:principal=""></span>
						</span> <i class="ace-icon fa fa-caret-down"></i>
                </a>
                    <ul
                            class="user-menu dropdown-menu-right dropdown-menu dropdown-yellow dropdown-caret dropdown-close">
                        <li><a id="changePassword" href="#"> <i
                                class="ace-icon fa fa-lock"></i> 更改密码
                        </a></li>
                        <li class="divider"></li>
                        <li><a id='logout' href="#"> <i
                                class="ace-icon fa fa-power-off"></i> 安全退出
                        </a></li>
                    </ul>
                </li>
            </ul>
        </div>
        <!-- /section:basics/navbar.dropdown -->
    </div>
    <!-- /.navbar-container -->
</div>

<!-- /section:basics/navbar.layout -->
<div class="main-container" id="main-container">
    <script type="text/javascript">
        /*<![CDATA[*/
        try {
            ace.settings.check('main-container', 'fixed')
        } catch (e) {
        }
        /*]]>*/
    </script>

    <!-- #section:basics/sidebar -->
    <div id="sidebar" class="sidebar responsive">
        <script type="text/javascript">
            /*<![CDATA[*/
            try {
                ace.settings.check('sidebar', 'fixed')
            } catch (e) {
            }
            /*]]>*/
        </script>

        <div class="sidebar-shortcuts" id="sidebar-shortcuts">
            <div class="sidebar-shortcuts-large" id="sidebar-shortcuts-large">
                <button class="btn btn-success">
                    <i class="ace-icon fa fa-signal"></i>
                </button>

                <button class="btn btn-info">
                    <i class="ace-icon fa fa-pencil"></i>
                </button>

                <!-- #section:basics/sidebar.layout.shortcuts -->
                <button class="btn btn-warning">
                    <i class="ace-icon fa fa-users"></i>
                </button>

                <button class="btn btn-danger">
                    <i class="ace-icon fa fa-cogs"></i>
                </button>

                <!-- /section:basics/sidebar.layout.shortcuts -->
            </div>

            <div class="sidebar-shortcuts-mini" id="sidebar-shortcuts-mini">
                <span class="btn btn-success"></span> <span class="btn btn-info"></span>

                <span class="btn btn-warning"></span> <span class="btn btn-danger"></span>
            </div>
        </div>
        <!-- /.sidebar-shortcuts -->

        <ul class="nav nav-list">
        </ul>
        <!-- /.nav-list -->

        <!-- #section:basics/sidebar.layout.minimize -->
        <div class="sidebar-toggle sidebar-collapse" id="sidebar-collapse">
            <i class="ace-icon fa fa-angle-double-left"
               data-icon1="ace-icon fa fa-angle-double-left"
               data-icon2="ace-icon fa fa-angle-double-right"></i>
        </div>

        <!-- /section:basics/sidebar.layout.minimize -->
        <script type="text/javascript">
            /*<![CDATA[*/
            try {
                ace.settings.check('sidebar', 'collapsed')
            } catch (e) {
            }
            /*]]>*/
        </script>
    </div>
    <!-- /section:basics/sidebar -->

    <div class="main-content">
        <div class="main-content-inner">
            <!-- #section:basics/content.breadcrumbs -->
            <div class="breadcrumbs" id="breadcrumbs">
                <script type="text/javascript">
                    /*<![CDATA[*/
                    try {
                        ace.settings.check('breadcrumbs', 'fixed')
                    } catch (e) {
                    }
                    /*]]>*/
                </script>

                <ul class="breadcrumb">
                    <li><i class="ace-icon fa fa-home home-icon"></i> <a
                            href="javascript:void(0);">Home</a></li>
                </ul>
                <!-- /.breadcrumb -->
            </div>
            <!-- /section:basics/content.breadcrumbs -->

            <div class="page-content">
                <!-- #section:settings.box -->
                <div class="ace-settings-container" id="ace-settings-container">
                    <div class="btn btn-app btn-xs btn-warning ace-settings-btn"
                         id="ace-settings-btn">
                        <i class="ace-icon fa fa-cog bigger-130"></i>
                    </div>

                    <div class="ace-settings-box clearfix" id="ace-settings-box">
                        <div class="pull-left width-50">
                            <!-- #section:settings.skins -->
                            <div class="ace-settings-item">
                                <div class="pull-left">
                                    <select id="skin-colorpicker" class="hide">
                                        <option data-skin="no-skin" value="#438EB9">#438EB9</option>
                                        <option data-skin="skin-1" value="#222A2D">#222A2D</option>
                                        <option data-skin="skin-2" value="#C6487E">#C6487E</option>
                                        <option data-skin="skin-3" value="#D0D0D0">#D0D0D0</option>
                                    </select>
                                </div>
                                <span>&nbsp; Choose Skin</span>
                            </div>

                            <!-- /section:settings.skins -->

                            <!-- #section:settings.navbar -->
                            <div class="ace-settings-item">
                                <input type="checkbox" class="ace ace-checkbox-2"
                                       id="ace-settings-navbar"/> <label class="lbl"
                                                                         for="ace-settings-navbar"> Fixed Navbar</label>
                            </div>

                            <!-- /section:settings.navbar -->

                            <!-- #section:settings.sidebar -->
                            <div class="ace-settings-item">
                                <input type="checkbox" class="ace ace-checkbox-2"
                                       id="ace-settings-sidebar"/> <label class="lbl"
                                                                          for="ace-settings-sidebar"> Fixed
                                Sidebar</label>
                            </div>

                            <!-- /section:settings.sidebar -->

                            <!-- #section:settings.breadcrumbs -->
                            <div class="ace-settings-item">
                                <input type="checkbox" class="ace ace-checkbox-2"
                                       id="ace-settings-breadcrumbs"/> <label class="lbl"
                                                                              for="ace-settings-breadcrumbs"> Fixed
                                Breadcrumbs</label>
                            </div>

                            <!-- /section:settings.breadcrumbs -->

                            <!-- #section:settings.rtl -->
                            <div class="ace-settings-item">
                                <input type="checkbox" class="ace ace-checkbox-2"
                                       id="ace-settings-rtl"/> <label class="lbl"
                                                                      for="ace-settings-rtl"> Right To Left
                                (rtl)</label>
                            </div>

                            <!-- /section:settings.rtl -->

                            <!-- #section:settings.container -->
                            <div class="ace-settings-item">
                                <input type="checkbox" class="ace ace-checkbox-2"
                                       id="ace-settings-add-container"/> <label class="lbl"
                                                                                for="ace-settings-add-container"> Inside
                                <b>.container</b></label>
                            </div>

                            <!-- /section:settings.container -->
                        </div>
                        <!-- /.pull-left -->

                        <div class="pull-left width-50">
                            <!-- #section:basics/sidebar.options -->
                            <div class="ace-settings-item">
                                <input type="checkbox" class="ace ace-checkbox-2"
                                       id="ace-settings-hover"/> <label class="lbl"
                                                                        for="ace-settings-hover"> Submenu on
                                Hover</label>
                            </div>

                            <div class="ace-settings-item">
                                <input type="checkbox" class="ace ace-checkbox-2"
                                       id="ace-settings-compact"/> <label class="lbl"
                                                                          for="ace-settings-compact"> Compact
                                Sidebar</label>
                            </div>

                            <div class="ace-settings-item">
                                <input type="checkbox" class="ace ace-checkbox-2"
                                       id="ace-settings-highlight"/> <label class="lbl"
                                                                            for="ace-settings-highlight"> Alt. Active
                                Item</label>
                            </div>

                            <!-- /section:basics/sidebar.options -->
                        </div>
                        <!-- /.pull-left -->
                    </div>
                    <!-- /.ace-settings-box -->
                </div>
                <!-- /.ace-settings-container -->
                <!-- /section:settings.box -->

                <div class="page-content-area" data-ajax-content="true">
                    <!-- ajax content goes here -->
                </div>
                <!-- /.page-content-area -->
            </div>
            <!-- /.page-content -->
        </div>
    </div>
    <!-- /.main-content -->

    <div class="footer">
        <div class="footer-inner">
            <!-- #section:basics/footer -->
            <div class="footer-content">
                <!--<a href="http://www.bizdata-info.com/" target="_blank">南京商数信息技术有限公司</a>-->
                <span class="bigger-120"> &copy; 2016-2017</span>
            </div>
            <!-- /section:basics/footer -->
        </div>
    </div>

    <a href="#" id="btn-scroll-up"
       class="btn-scroll-up btn btn-sm btn-inverse"> <i
            class="ace-icon fa fa-angle-double-up icon-only bigger-110"></i>
    </a>
</div>

<!-- basic scripts -->

<!--[if !IE]> -->
<script type="text/javascript" th:inline="javascript">
    /*<![CDATA[*/
    window.jQuery
    || document.write("<script src='../assets/js/jquery-2.1.4.min.js'>"
        + "<" + "/script>");
    /*]]>*/
</script>
<!-- <![endif]-->

<!--[if IE]>
<script type="text/javascript" th:inline="javascript">
    window.jQuery || document.write("<script src='${ctx }assets/js/jquery1x.js'>" + "<" + "/script>");
</script>
<![endif]-->
<script type="text/javascript" th:inline="javascript">
    /*<![CDATA[*/
    if ('ontouchstart' in document.documentElement)
        document.write("<script th:src='@{assets/js/jquery.mobile.custom.js}'>"
            + "<" + "/script>");
    /*]]>*/
</script>

<script th:src="@{/assets/js/bootstrap.js}"></script>
<script th:src="@{/assets/js/jquery-ui.js}"></script>

<!-- jquery表单验证 -->
<script th:src="@{/assets/js/jquery.validate.js}"></script>
<script th:src="@{/assets/js/additional-methods.js}"></script>
<!-- sdevil507 2015-12-20 add 根据后台返回的全局量，401值进行页面的跳转，此处用于超时跳转到登录页 -->
<script th:inline="javascript">
    /*<![CDATA[*/
    $.ajaxSetup({
        complete: function (XMLHttpRequest, textStatus) {
            if ("401" == XMLHttpRequest.status) {
                alert("你已被系统强制退出!原因可能如下:\n\n1.登录超过\n2.你的账号在别处登录\n3.账户已被管理员禁用");
                var target = /*[[@{/admin}]]*/ '跳转至/contextPath/admin'
                window.location.href = target;
            }
        }
    });

    /* 安全退出选项 */
    $('#logout').click(function () {
        var state = confirm("确认安全退出?");
        if (!state) {
            return false
        } else {
            var target = /*[[@{/admin/logout}]]*/ ''
            window.location.href = target
        }
    });

    //重载dialog框,使标题支持html
    $.widget("ui.dialog", $.extend({}, $.ui.dialog.prototype, {
        _title: function (title) {
            var $title = this.options.title || '&nbsp;'
            if (("title_html" in this.options) && this.options.title_html == true)
                title.html($title);
            else
                title.text($title);
        }
    }));

    /* 更改密码 */
    $('#changePassword')
        .on(
            'click',
            function (e) {
                e.preventDefault();
                var dialog = $("#dialog-change-password")
                    .removeClass('hide')
                    .dialog(
                        {
                            modal: true,
                            title: "<div class='widget-header widget-header-small'><h4 class='smaller'><i class='ace-icon fa fa-lock'></i>更改密码</h4></div>",
                            title_html: true,
                            buttons: [{
                                text: "取消",
                                "class": "btn btn-minier",
                                click: function () {
                                    $(this).dialog("close");
                                }
                            }, {
                                text: "确认",
                                "class": "btn btn-primary btn-minier",
                                click: function () {
                                    var valid = $('#validation-form').valid();
                                    if (valid) {
                                        //提交密码进行更新
                                        $.post(/*[[@{/admin/user/changePassword}]]*/ '', {
                                            password: $('#new_password').val()
                                        }, function (result) {
                                            $('#dialog-change-password').dialog("close");
                                        });
                                    }
                                }
                            }]
                        });
            });

    $('#validation-form').validate(
        {
            onfocusout: function (element) {
                $(element).valid();
            },
            errorElement: 'div',
            errorClass: 'help-block',
            focusInvalid: false,
            ignore: "",
            rules: {
                old_password: {
                    required: true,
                    remote: {
                        url:/*[[@{/admin/user/checkPassword}]]*/ '',
                        type: "GET",
                        dataType: "json",
                        data: {
                            //如果不填,默认就是该name名称,old_password
                        },
                        dataFilter: function (data) {
                            if (data == 'true') {
                                return true;
                            } else {
                                return false;
                            }
                        }
                    }
                },
                new_password: {
                    required: true,
                    passwordCheck: true
                },
                confirm_old_password: {
                    required: true,
                    equalTo: "#new_password"
                }
            },
            messages: {
                old_password: {
                    required: "原始密码必须填写",
                    remote: "请输入正确的原始密码"
                },
                new_password: {
                    required: "新密码必须填写",
                },
                confirm_old_password: {
                    required: "新密码必须确认",
                    equalTo: "两次密码输入不一致"
                }
            },
            highlight: function (e) {
                $(e).closest('.clearfix').removeClass('has-info').addClass(
                    'has-error');
            }
        });

    $.validator.addMethod("passwordCheck", function (value, element, params) {
        var rule = /(?=.*[A-Z])(?=.*[a-z])(?=.*[0-9])[a-zA-Z0-9]{8,16}$/;
        return this.optional(element) || (rule.test(value));
    }, "密码必须包含至少一个大写字母、一个小写字母、一个数字，长度为8~16位！");

    /*]]>*/
</script>
<script>
    /*<![CDATA[*/
    $.ajax({
        url: "getCurrentUserMenus",
        async: false,
        dataType: "JSON",
        success: function (resp) {
            var html = ""

            html += '<li class="active">'
            html += '<a data-url="page/index" href="#page/index">'
            html += '<i class="menu-icon fa fa-tachometer"></i>'
            html += '<span class="menu-text">首页</span>'
            html += '</a>'
            html += '<b class="arrow"></b>'
            html += '</li>'

            if (0 == resp.code) {
                for (var i = 0, l = resp.content.length; i < l; i++) {
                    var f = resp.content[i]
                    if (f.menus.length > 0) {
                        html += '<li class="">'
                        html += '<a href="#" class="dropdown-toggle">'
                        html += '<i class="menu-icon ' + f.icon + '"></i>'
                        html += '<span class="menu-text">' + f.name + '</span>'
                        html += '<b class="arrow fa fa-angle-down"></b>'
                        html += '</a>'
                        html += '<b class="arrow"></b>'
                        html += '<ul class="submenu">'
                        for (var j = 0, ll = f.menus.length; j < ll; j++) {
                            var c = f.menus[j]
                            html += '<li class="">'
                            html += '<a data-url="page' + c.url + '" href="#page' + c.url + '">'
                            html += '<i class="menu-icon fa fa-caret-right"></i>'
                            html += c.name
                            html += '</a>'
                            html += '<b class="arrow"></b>'
                            html += '</li>'
                        }
                        html += '</ul>'
                        html += '</li>'
                    } else {
                        //当只有一级菜单时，展示菜单
                        html += '<li class="">'
                        html += '<a data-url="page' + f.url + '" href="#page' + f.url + '">'
                        html += '<i class="menu-icon ' + f.icon + '"></i>'
                        html += '<span class="menu-text"> ' + f.name + ' </span>'
                        html += '</a>'
                        html += '<b class="arrow"></b>'
                        html += '</li>'
                    }
                }
            }
            $("#sidebar	.nav-list").html(html)
            var index = location.href.split("#")[1]
            $("a[data-url='" + index + "']").addClass("active")
        }
    })
    /*]]>*/
</script>

<!-- ace scripts -->
<!-- 百度地图 -->
<script th:src="'http://api.map.baidu.com/api?v=1.3'"></script>
<script th:src="@{/assets/js/ace/elements.scroller.js}"></script>
<script th:src="@{/assets/js/ace/elements.colorpicker.js}"></script>
<script th:src="@{/assets/js/ace/elements.fileinput.js}"></script>
<script th:src="@{/assets/js/ace/elements.typeahead.js}"></script>
<script th:src="@{/assets/js/ace/elements.wysiwyg.js}"></script>
<script th:src="@{/assets/js/ace/elements.spinner.js}"></script>
<script th:src="@{/assets/js/ace/elements.treeview.js}"></script>
<script th:src="@{/assets/js/ace/elements.wizard.js}"></script>
<script th:src="@{/assets/js/ace/elements.aside.js}"></script>
<script th:src="@{/assets/js/ace/ace.js}"></script>
<script th:src="@{/assets/js/ace/ace.ajax-content.js}"></script>
<script th:src="@{/assets/js/ace/ace.touch-drag.js}"></script>
<script th:src="@{/assets/js/ace/ace.sidebar.js}"></script>
<script th:src="@{/assets/js/ace/ace.sidebar-scroll-1.js}"></script>
<script th:src="@{/assets/js/ace/ace.submenu-hover.js}"></script>
<script th:src="@{/assets/js/ace/ace.widget-box.js}"></script>
<script th:src="@{/assets/js/ace/ace.settings.js}"></script>
<script th:src="@{/assets/js/ace/ace.settings-rtl.js}"></script>
<script th:src="@{/assets/js/ace/ace.settings-skin.js}"></script>
<script th:src="@{/assets/js/ace/ace.widget-on-reload.js}"></script>
<script th:src="@{/assets/js/ace/ace.searchbox-autocomplete.js}"></script>
</body>
</html>